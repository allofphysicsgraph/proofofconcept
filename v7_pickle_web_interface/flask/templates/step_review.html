{% extends "_base.html" %}
{% block content %}


<P>step review

<P>derivation name: {{ dat["derivations"][deriv_id]["name"] }}

<P>
<form method="post" action=""> 
<!-- https://stackoverflow.com/questions/19794695/flask-python-buttons -->
    <!-- https://flask-wtf.readthedocs.io/en/v0.12/csrf.html -->
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

   <input type="submit" name="submit_button" value='accept this step; add another step'>
   <input type="submit" name="submit_button" value='accept this step; review derivation'>
   <input type="submit" name="submit_button" value='modify this step'>
</form>

<!-- https://stackoverflow.com/questions/28207761/where-does-flask-look-for-image-files -->
<P><img src="{{ url_for('static', filename=name_of_graphviz_png) }}">


<h2>AST for each expression in step</h2>
  <P>From Sympy's parsing of the Latex
    {% for ast_png_and_id in list_of_expression_AST_dicts %}
      <P>
        <a href="{{ url_for('list_all_expressions') }}?referrer=modify_step#{{ ast_png_and_id['expr global id'] }}">{{ ast_png_and_id['expr global id'] }}</a>: \({{ dat['expressions'][ast_png_and_id['expr global id']]['latex'] }}\)<BR>
        symbols from Sympy: {{ ast_png_and_id['symbols from sympy'] }}<BR>
        symbols from PDG AST:
        {% for symbol_id in ast_png_and_id['symbols from PDG AST'] %}
          (<a href="{{ url_for('list_all_symbols') }}?referrer=modify_step#{{ symbol_id }}">{{ symbol_id }}</a>:
          {{ dat['symbols'][symbol_id]['latex'] }}),
        {% endfor %}
      <BR>
      {% if ast_png_and_id["sympy symbols without PDG AST ID"]|length > 0 %}
        Sympy symbols lacking PDG AST ID: {{ ast_png_and_id["sympy symbols without PDG AST ID"] }}<BR>
      {% else %}
        all Sympy symbols have corresponding PDG AST IDs<BR>
      {% endif %}
      <img src="{{ url_for('static', filename=ast_png_and_id['ast png filename']) }}">
    {% endfor %}
  </p>

<H2>Symbols in use in this step according to Sympy</h2>
  <P>From Sympy's parsing of the Latex
    <UL>
      {% for symbol_latex in list_of_symbols_from_sympy %}
        <LI> {{ symbol_latex }} </LI>
      {% endfor %}
    </UL>
  </P>

<h2>Symbols in PDG AST for this step</h2>
<UL>
  {% for symbol_id in list_of_symbols_from_PDG_AST %}
    <LI> <a href="{{ url_for('list_all_symbols') }}?referrer=modify_step#{{ symbol_id }}">{{ symbol_id }}</a>:
     {{ dat['symbols'][symbol_id]['latex'] }}
  {% endfor %}
</UL>




<P>
{% include '_table_of_derivation_steps.html' %}

<P>
{% include '_table_of_expressions.html' %}


{% endblock %}

