# https://docs.docker.com/compose/compose-file/

# https://docs.docker.com/compose/compose-file/#environment
version: "3.6"

services:
  webserver:
    build:
      context: ./webserver
      dockerfile: Dockerfile
    restart: unless-stopped 
# using "ports" makes flask/gunicorn accessible without going through nginx
    expose:
      - 5000
    depends_on:
      - "neo4j_docker"
    networks:
      neo4j-internal:
        aliases:
          - neo4j-network
    ports:
     - "5000:5000"
    volumes:
     - ${PWD}/:/scratch

  # see https://neo4j.com/docs/operations-manual/current/docker/introduction/
  # https://neo4j.com/docs/operations-manual/current/docker/clustering/
  neo4j_docker:
    image: neo4j:4.4.4-community
    #network_mode: "bridge"
    restart: unless-stopped
    hostname: neo4j_host
    networks:
      neo4j-internal:
        aliases:
          - neo4j-network

    container_name: neo4j

    # The ports that will be accessible from outside the container
    # 7474=HTTP, 7473=HTTPS, 7687=Bolt; as per https://neo4j.com/developer/docker-run-neo4j/
    ports:
      - "7474:7474"
      - "7473:7473"
      - "7687:7687"
    volumes:
      - '$HOME/neo4j/data:/data'
    # https://docs.docker.com/compose/compose-file/compose-file-v3/#environment
    # see https://neo4j.com/docs/operations-manual/current/docker/ref-settings/
    environment:
      - NEO4J_dbms_allow__upgrade=true
      - NEO4J_AUTH=none

networks:
  neo4j-internal:

# EOF

